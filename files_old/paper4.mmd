# Droop-Controlled Inverters as Educational Control Design Project

Jimmy Chih-Hsien Peng \({}^{\copyright}\),, Gurupraanesh Raman \({}^{\copyright}\),,

John Long Soon \({}^{\copyright}\),, and Nikos D. Hatziargyriou \({}^{\copyright}\),

Manuscript received April 15, 2021; revised June 30, 2021; accepted August 11, 2021. Date of publication August 19, 2021; date of current version March 28, 2022. This work was supported in part by the Singapore Ministry of Education Academic Research Fund under Grant R-263-000-ID-11-T4. Paper no. TPWRS-00609-2021. (_Corresponding author: Jimmy Chih-Hsien Peng._) Jimmy Chih-Hsien Peng, Gurupraanesh Raman, and John Long Soon are with the Department of Electrical and Computer Engineering, National University of Singapore, Singapore 117583, Singapore (e-mail: j.peng@ieee.org; gruprupraanesh@u.nus.edu; soonjolnlong1988@gmail.com).Nikos D. Hatziargyriou \({}^{\copyright}\), _Fellow_, _IEEE_

###### Abstract

Electric grids are seeing increasing adoption of renewables interfaced with power electronics. As the share of renewable generation increases, the inverters are expected to operate in grid-forming mode to replace large conventional synchronous generation. Further, in geographical islands and isolated/rural areas, inverters interfacing renewable generators and storage are used to form the grids and share the loads. Given the expected presence of grid-forming inverters in future power systems, there is an urgent need to revise education curricula about the stability issues arising from these interconnected inverters. Existing training is overly reliant on numerical simulation or on expensive tools such as real-time simulators. In this paper, we present a laboratory hands-on project dealing with small-signal stability in droop-controlled inverters. It entails simulation and hands-on experimentation for which an inexpensive microgrid set up was developed in-house at the National University of Singapore. The design project can be integrated into power engineering courses offered to senior and postgraduate students.

 Droop control, education, inverter-based systems, microgrid, power systems, stability and control.

## I Introduction

Modern power systems are increasingly equipped with power electronic converters such as inverters to interface renewable generation and FACTS devices to provide network compensation. Traditionally, power electronics are studied at the device/equipment level, whereas the dynamic stability between power converters is rarely touched upon. This topic has gained industry attention in recent years (e.g., [1]). In particular, the oscillatory interactions between inverters to resolve power imbalances in AC grids have been demonstrated to trigger network instability [2, 3, 4]. Since present educational curricula do not include training power engineers to address these new dynamic phenomena, this task is left to the industry. To close this gap, the motivation of this paper is to present a teaching curriculum that engages students (particularly senior and postgraduate) to understand the control of inverter-based systems used to manage renewable distributed energy resources.

Controlling inverters to regulate the voltage/frequency and provide stable power sharing within an autonomous grid, i.e., microgrid, or within a broader distribution system is of high interest to the grid-edge revolution--empowering prosumers to provide grid services to low-voltage power networks [5]. Different to classic electromechanical oscillations witnessed in conventional grids, inverter-generated oscillations are largely triggered by the designed power controllers [6]. As synchronous generators are being replaced by renewables, such oscillatory dynamics will be evermore dominant in future grids. Among the various power sharing approaches, droop control is perhaps the most widely recognized solution given its analogous behavior to the classic synchronous generator [7]. Thus, the design of droop-controlled inverters is identified as the logical application to train young engineers regarding the stability and control of inverter-based power systems.

Hands-on implementation of taught concepts is considered as the best teaching pedagogy in engineering courses [8]. However, safety concerns and cost considerations often constrain the instructor's ability to demonstrate theoretical knowledge using practical examples in educational institutions. For instance, developing an educational microgrid in the laboratory would require the acquisition of expensive equipment such as programmable loads, real-time emulators, and protection devices [8]. Furthermore, safety certifications need to be obtained from the institution and the local power utility, which can be a lengthy bureaucratic process along with costly annual upkeep expenses. These deterring factors lead many institutions to resort to numerical simulations, despite the abstractness of the virtual environment [9, 10]. In fact, the use of simulations is not the ideal pedagogy for teaching power electronics to young engineers as reported in [11]. One cannot fully appreciate the concepts without building/working with the actual physical components. Recognizing this issue, the power electronics society has developed pedagogical hardware experience over the last few decades [12]. In contrast, little has been done in the power systems community. Although attempts have been conducted in the recent years, they generally demand significant initial hardware investment; this is discouraging to most academic institutions, especially those in the developing countries. It should be noted that rural electrification in developing countries,often based on microgrids and renewable integration, rely on the deployment of power electronics technologies. However most of the targeted communities do not have the financial capability to procure those expensive equipment for training their engineers [13, 14, 15]. Many community projects have consequently failed in the long-term due to the lack of proper maintenance and inadequate operation [16]. There is a need for a practical solution to train engineers about inverter control without costly investments, which defines the scope of this paper.

The contribution is the development of a student project consisting of a set of tasks in the context of inverter control and stability analysis. In our case, the design project has been integrated into a graduate module at the National University of Singapore entitled EE5702--Advanced Power Systems Analysis. Students are first lectured on the operating principles of inverters and in modeling their dominant dynamics. Subsequently, they build droop controllers that satisfy a set of given specifications outlined by the project tasks. The design and analysis stages rely on numerical simulations, while the validation is performed using an experimental microgrid. The experimental microgrid constructed for this project focuses on the dominant dynamics of interconnected inverters while neglecting load dynamics, as these have been proven to have little contribution to the small-signal stability [4, 17]. It comprises of 3 three-phase inverters sharing constant impedance loads, and is capable of capturing the oscillatory dynamics witnessed at various ratings. The inverters are supplied by a DC power supply representing an ideal source. Details regarding PCB fabrication and codes are made available for teaching instructors at [18]. Overall, this paper puts forth a holistic approach to train power engineers on the stability of inverter-based generations in an electric grid in a relatively cost-effective manner. As a result, the proposed project can reach a much broader audience than just well-funded institutions.

The learning outcomes for the design project are as follows:

1. Design closed-loop voltage control for a three-phase inverter using current and voltage PI controllers.
2. Implement decentralized power sharing among multiple grid-forming inverters using droop control.
3. Design and implement generalized droop control and lead-lag compensators for guaranteeing stability for all droop gains and network configurations.

The layout of the upcoming sections is as follows. Theoretical concepts, simulation approaches, and experimental setup are described in Section II. Subsequently, project tasks and their expected results are presented in Section III. Finally, conclusions are drawn in Section IV.

## II Concepts and Analysis

The design project demands students to apply theoretical concepts into working solutions and resolve the small-signal instability within a microgrid. Students are first asked to model the microgrid, and then verify their inverter droop controller designs using MATLAB/Simulink. Finally they implement their design in the experimental microgrid for validation. Upon completion of the project, students are expected to become familiar with inverter modeling, control design, and stability analysis in addition to gaining hands-on experimentation skills. Details of the required theoretical knowledge, simulation models, and the experimental microgrid setup are discussed in the forthcoming subsections.

### _Droop Control Fundamentals_

Droop control is one of the most commonly implemented methods of decentralized power sharing among different power electronic inverters. A droop-controlled inverter mimics the behavior of a synchronous machine by reducing its output frequency and voltage in a linear proportion to the active and reactive power drawn from it [7]. The steady-state \(f\)-\(P\) and \(V\)-\(Q\) characteristics for the _conventional droop control_ are shown in Fig. 1, and can be mathematically represented as:

\[f =f_{0}-k_{f}P\] \[V_{ref} =V_{0}-k_{v}Q, \tag{1}\]

where \(P\) and \(Q\) are respectively the active and reactive power outputs of the inverter, \(f\), its output frequency, and \(V_{ref}\), its terminal voltage. The subscript '0' indicates the no-load or nominal value. The parameters \(k_{f}\) and \(k_{v}\) are the droop coefficients or gains. Based on (1), the conventional droop control can be more precisely referred to as the \(P\)-\(f\)/\(Q\)-\(V\) droop.

The working of droop control is explained as follows. Considering a system with \(n\) droop-controlled sources, the frequency of each source should be equal in the equilibrium state. As a result, the active power outputs must satisfy:

\[k_{f1}P_{1}=k_{f2}P_{2}=\cdots=k_{fn}P_{n} \tag{2}\]

which yields the relation:

\[P_{i}\propto\frac{1}{k_{fi}}\;\;\forall i\in[1,n] \tag{3}\]

Therefore, each source takes up a fraction of the total active load inversely proportional to its frequency droop coefficient. Conversely, the droop coefficients of each inverter must be chosen in inverse proportion to its capacity, so that its steady-state power output is proportional to the capacity. Note that this type of droop control does not enable accurate reactive power sharing along similar lines as active power because the steady state voltages of the sources depend on the interconnection topology and load locations, and are therefore not always equal [19].

Fig. 1: Frequency and voltage characteristics for conventional droop control.

### _Modeling a Three-Phase Inverter_

A droop-controlled three-phase inverter entails a DC source connected to a three-legged bridge, whose outputs are fed through an \(LC\) filter designed to meet THD requirements. The frequency and RMS voltage set points for the inverter output are dictated by the droop controller, based on the measurements of the active and reactive power drawn from the inverter. Typically, the measured power values in the droop controller are first passed through a first-order low pass filter, whose time constant \(T_{c}\) determines the inertial behavior of the inverter. The output frequency set point is tracked by changing the rate of change of the phase angle reference \(\delta\), and the voltage magnitude, using cascaded voltage and current PI controllers along the \(d\) and \(q\) axes.

The current and voltage controllers should be designed such that the droop, voltage, current, and pulse-width modulation controllers have bandwidths in increasing order, with each stage significantly faster than its preceding one. This time-scale separation ensures that the different stages do not interact which could reduce the stability margin of the entire cascade [20, 21]. It also conveniently enables the independent design of the controllers in each loop. Given the inverter switching frequency \(f_{sw}\), the filter inductance \(L_{f}\) and internal resistance \(R_{f}\), the current PI controller \((k_{pi}+k_{ii}/s)\) can be systematically designed as per the above principles as:

\[k_{pi} =L_{f}\;\omega_{Bi}\] \[k_{ii} =R_{f}\;\omega_{Bi}, \tag{4}\]

where \(\omega_{Bi}=(2\pi f_{sw})/\alpha\) is the bandwidth of the current controller, and \(\alpha\) is the bandwidth ratio, typically selected between 3 to 10. Similarly, given the filter capacitance \(C_{f}\) and the expected load resistance \(R_{load}\), the voltage PI controller \((k_{pv}+k_{iv}/s)\) can be designed as:

\[k_{pv} =C_{f}\;\omega_{Bv}\] \[k_{iv} =\frac{\omega_{Bv}}{R_{load}}, \tag{5}\]

where \(\omega_{Bv}=(2\pi f_{sw})/\alpha^{2}\) is the bandwidth of the voltage controller. Finally, the slowest controller, i.e., the droop controller, is typically designed with a bandwidth of 2 to 15 Hz by appropriately selecting \(T_{c}\).

Considering the above cascaded control structure, the "detailed model" of the droop-controlled inverter shown in Fig. 2 considers all the hardware components including switches (treated to be ideal) and the \(LC\) filter (ignoring parasitic elements), in addition to the software components- the droop, voltage and current control loops. As such, it is the most accurate representation of the physical inverter. However, the detailed model requires significant computational resources for simulation due to the relatively higher-bandwidth dynamics of the inner voltage and current loops considered, as well as the switches and the \(LC\) filter. To aid in faster simulation while preserving the system-level dynamics, a "simplified model" can be used, where the voltage and current control loops are assumed to be stable and infinitely fast. This is a justifiable assumption given the time-scale separation between the dynamics of the cascaded controllers [22]. As a result, the inverter can then be conveniently modeled as an ideal voltage source with the same droop controller as before. This is shown in Fig. 3.

### _Ensuring Stability Under Droop Control_

The small-signal instabilities arising in multi-inverter microgrids under conventional droop control (1) can be attributed to the following two factors pertaining to power flow in the interconnection network.

Fig. 2: Detailed model of a three-phase inverter with cascaded droop, voltage and current control loops.

#### Iv-C1 P-V/Q-f Cross-Coupling

In transmission systems where the conventional droop control is originally borrowed from, the power lines are predominantly inductive in nature. Therefore, the active power flow through a line is strongly coupled to the phase angle difference and the reactive power, on the voltage magnitude difference across the terminal ends. The conventional droop control reflects this relationship, with the droops in frequency and voltage dependent on the active and reactive power, respectively. However, in the distribution level, the lines have non-negligible resistances. This introduces cross-coupling between the active power and voltage, and between the reactive power and frequency, which increases with the \(R/X\) ratio of the network.

#### Iv-C2 Distribution System Lag

The behavior of the interconnection network is resistive-inductive, which means that the power flows are subject to a phase lag dependent on the \(R/X\) ratio. For lower values of \(R/X\), the phase lag can be high, reducing the phase margin, and potentially destabilizing the medium- as well as low-frequency modes of the system [3].

The destabilizing influence of the cross-coupling effect can be nullified by using generalized droop control, where the power measurement frame of each inverter is rotated so that the power flow dynamics appear inductive in the rotated frame (see Fig. 4). The droop control equations in the steady-state therefore become:

\[f =f_{0}-k_{f}(P\cos\phi-Q\sin\phi)\] \[V =V_{0}-k_{v}(P\sin\phi+Q\cos\phi), \tag{6}\]

with \(\phi=\tan^{-1}\rho\), \(\rho\) being the \(R/X\) ratio of the network.

On the other hand, the effect of distribution system lag can be addressed by modifying the power measurement filter in the droop control loop, such that it provides an equivalent phase lead. The filter now takes an improved lead-lag compensator form

\[F(s)=\frac{s^{2}/\omega_{0}^{2}+2\rho s/\omega_{0}+1+\rho^{2}}{(\rho^{2}+1)(T _{c}s+1)(\tau s+1)}, \tag{7}\]

where \(\omega_{0}\) is the nominal grid frequency (here, \(2\pi(50)\) rad/s), and the time constant \(\tau\) should satisfy \(\tau<<T_{c}\) (typically selected as 0.001 s).

Overall, for a given network \(R/X\) ratio \(\rho\) and droop controller time constant \(T_{c}\), the generalized droop controller (6) and lead-lag compensator (7) has no parameters that require tuning, making control design very convenient. For detailed proofs on how these control modifications guarantee the stability, the reader is referred to [3] and the accompanying lecture slides in [18].

### _Experimental Design_

The educational microgrid is pictured in Fig. 5, and consists of 3 three-phase inverters interconnected in the topology shown in Fig. 6. Each inverter is controlled by TI-F28335 DSP, and is fed by a full-bridge rectifier whose input is obtained from the 400 V three-phase AC mains. The interconnection lines are implemented as lumped resistors and inductors, which can be flexibly adjusted. Two resistive loads are connected at the output of Inverter-1, one of which can be switched to create real time disturbances. Furthermore, protection circuits, i.e., fuses

Fig. 4: Illustrating droop control action under (a) conventional droop control and (b) generalized droop control.

Fig. 5: The developed three-inverter microgrid setup used for experimental verification of stability concepts.

Fig. 3: Simplified model of a three-phase inverter, represented as an ideal voltage source operated under droop control.

and relays, are installed to prevent hardware failure and ensure the safety of the students. Detailed design specifications, e.g., component models and PCB designs, and micro-controller codes are made available in [18]. These codes are programmed in C language and contain all the necessary functions to operate the three-phase inverter required for this design project. They are executed using Code Composer Studio, and users can modify the controller gains and calibrate the sensors as required for their individual microgrids. Overall, the construction cost of this educational microgrid is around USD 1,000 [23].

## 3 Project Tasks and Execution

In the project, the students are expected to simulate an islanded microgrid consisting of inverter-based generation. More specifically, they are trained to systematically develop and implement droop controllers such that the grid stability is guaranteed for any droop gain values and network impedances. Note that the theoretical background for the topic, e.g., design of cascaded controllers with appropriate time-scale separation, small-signal models and stability analysis, should be first delivered through lectures prior to issuing the project. Lecture slides designed for this project can be accessed at [18].

The project tasks are designed to evaluate the students' ability to 1) collect, select, and use the given information from a datasheet to simulate an islanded microgrid consisting of inverter-based generation, 2) undertake independent research and inquiry, and 3) integrate theory and practice. They are divided into three stages. First, students will focus on modeling the inverter and microgrid. Second, they will proceed to design the inverter control and perform stability analysis. Finally, the developed controllers will be validated by numerical simulations and laboratory tests. In order to expose the students to various design issues, they can easily experiment with different control parameters using simulations, and observe their corresponding time-domain dynamics and analyze eigen plots. During this design phase, students are also encouraged to discuss the outcomes of the numerical simulations--a process that helps strengthen their understanding and trains their design skills. On the other hand, hardware validation is only conducted at the final stage of the project for safety considerations. Since students will be deliberately operating the inverters near instability, the hardware experiment is recommended to be conducted at low voltage, i.e., de-rated values, to ensure hardware safety, with accompanying simulations carried out additionally to validate the results. The microgrid rating can be increased to match the simulation parameters if permitted by the available infrastructure, technician credentials, and with appropriate safety precautions. We also note that if the hardware setup is not pushed to instability limits, then it can be safely operated at the full rating.

### _Project Tasks_

The design project consists of a total of 9 tasks. Tasks 1 to 8 are simulation-based using typical distribution ratings outlined in Table 1, while the experimental Task-9 is conducted using settings listed in Table 2. The tasks are detailed below.

* Task-1: Consider a single inverter with no droop control, connected to two loads, Loads 1 and 2. For the parameters from Table 1, implement cascaded current and voltage control loops to achieve closed-loop voltage control. Design the current and voltage PI controllers such that the voltage settling time is at least 5 times smaller than the time-constant of the droop controller (i.e., \(T_{c}\)). The peak overshoot of the voltage should be no more than 5%. Verify these requirements by switching ON Load-2 to create a step disturbance and observing the inverter RMS output voltage.

Fig. 6: Single-line diagram of the microgrid case study used for the project.

* Task-2: Add the conventional (\(P\)-\(f\)/\(Q\)-\(V\)) droop controller using the settings outlined in Table I to the inverter constructed in Task-1. Create a load disturbance by switching Load-2 ON. Observing the steady states before and after the disturbance, verify that the voltage and frequencies of the inverters conform to the desired \(P\)-\(f\) and \(Q\)-\(V\) droop characteristics.
* Task-3: Connect the droop-controlled inverter to an infinite bus through an impedance \((0.1+j0.1)\)\(\Omega\). Observe its time response to a step change in Load-2 ON at the inverter bus. Next, construct a simplified model of the same inverter that considers only the droop controller. That is, the \(LC\) filter, the voltage and current controllers will be removed by assuming the voltage control to be infinitely fast. Connect this model to an infinite bus and validate it against the detailed model by comparing the transient waveforms of \(P\), \(Q\), \(f\), and \(V\) when subjected to the same step change in load.
* Task-4: Use the simplified inverter model obtained in Task-3 for all the remaining tasks. Construct the three-inverter setup shown in Fig. 6. Using a load step-change, i.e., Load-2 ON, observe the active and reactive power shared by each inverter before and after the disturbance. Comment on the power sharing accuracy under conventional droop control.
* Task-5: Increase the frequency droop gain (\(k_{f}\)) of each inverter separately, while retaining the other inverters' \(k_{f}\) at the nominal value. Determine the point of marginal stability corresponding to each inverter, i.e., the \(k_{f}\) value where the damping ratio of the overall system becomes \(\zeta=0\). Present the time response (\(P\) and \(Q\) waveforms) of the multi-inverter system when the droop gains are separately changed from the nominal value to the above instability limit. Referring to the \(k_{f}\) limit for each inverter, comment on the relation between the interconnection impedance and stability margin.
* Task-6: Replace the conventional droop controller of each inverter by a generalized droop controller with the appropriate rotation angle. Also replace the conventional first-order filter with a lead-lag compensator using the appropriate phase gain at the grid frequency \(\omega_{0}=2\pi f_{0}\). Plot the Bode diagram of the new compensator along with that of the original first order filter, and measure their respective phase gains at grid frequency. Finally, use a load step disturbance, e.g., Load-2 ON, to discuss whether/how the power sharing accuracy is affected by the proposed control modifications in reference to conventional droop control.
* Task-7: Determine the time response of the modified system for the three different droop gain combinations as obtained from Task-5. Verify that the proposed design modifications make the system stable for the same droop gain values that made the original system oscillatory. In other words, demonstrate that the stability region has expanded for the modified droop controller.
* Task-8: The lead-lag compensator is parameterized by the term \(\rho\). From theoretical analysis, this value should be the same as the \(R/X\) ratio of the network, which for the given system is 1.0. Now, keeping the network impedances (i.e., \(R/X\)) fixed, investigate how the system damping changes if the designed \(\rho\) is changed. Take the droop gains (\(k_{f}\), \(k_{v}\)) for all the inverters as (0.5%, 5%), and compare the time domain power outputs for \(\rho=1.0\) (normal case), 0.1 (too small), and 7.0 (too large).
* Task-9: Repeat Tasks 5, 6, and 7 for the experimental microgrid whose parameters are listed in Table II. Subsequently, verify the expansion in stability region with the conventional droop controller with first-order filter and the generalized droop control with lead-lag compensation. Discuss the possible causes of the variations between the experimental and numerical results.

infinite grid is the simplest system where instability due to droop control can be potentially observed. Here, students will be exposed to practical issues such as resolving the trade-off between simulation time and accuracy, leading them to make design choices based on analytical thinking. The noticeable issue in the task is the long computing time to execute one simulated case study, which will become intolerable when simulating more inverters. Students should be able to identify the root cause being the use of the detailed inverter model, which is not scalable for simulating multi-inverter dynamics. To resolve this problem while retaining the accuracy of the results, the detailed model should be modified into reduced-order variant shown in Fig. 3. A properly-reduced model will exhibit a distinct simulation speedup while preserving the accuracy of the dominant power sharing dynamics, i.e., the power oscillations should have similar amplitudes and oscillatory frequencies as the case of detailed model. Further, this task enables students to observe the impact on the internal control loops on the system stability, and appreciate that well-designed inner loops do not significantly affect the dominant droop-control dynamics. The expected time-domain performance is illustrated in Fig. 8.
* Task-4: The objective of this task is to strengthen the theoretical understanding of power sharing under the conventional droop control law. Students will analyze the performance of their designed droop controllers for two different load configurations. Referring to the steady-state power contributed by each inverter listed in Table IV, they should conclude that the conventional droop control always ensures active power sharing in inverse proportion to the frequency droop gain. In contrast, the reactive power is not necessarily proportionally shared if the network topology and loads are asymmetrical with respect to the inverters. Moreover, although the loads are purely resistive, some inverters generate non-zero reactive power which leads to wasteful circulating currents. This task therefore provides the opportunity to study inequities in the reactive power sharing performance and highlights the need for secondary control to correct them. By now, students should have become familiar with inverter modeling, control design, and numerical validations using MATLAB/Simulink.
* Task-5: In this task, students will observe that an increase in the droop gains leads to instability. They are also expected to appreciate the effect of the frequency and voltage droop gains (\(k_{f}\) and \(k_{v}\)), on the system stability upon completion of this task. Specifically, the students can determine through simulations that the voltage droop gain does not have a significant impact on the dominant dynamics. For the given design specifications, the system becomes unstable when \(k_{f1}=0.81\)%, \(k_{f2}=0.56\)% and \(k_{f3}=0.81\)% (see Figs. 9(a)-(c) respectively). In each case, the frequency droop gains of the other inverters are maintained at 0.1%. The above limits signify the stability margin of the system at the different nodes, from which students should identify that the node with the lowest stability margin is the one that has the most interconnections and thereby the highest Thevenin admittance. This finding is a critical concept in stability analysis under droop control.
* Task-6: The conventional droop controller provides a limited stability region, which may not be sufficient if the grid operator demands faster time responses, or when the network impedances change. Here, the students will now proceed to formulate solutions that improve the damping ratio using a generalized droop controller summarized by (6) and Fig. 4. Furthermore, the compensator based on (7) will replace the original first-order filter in the droop controller. The students are also encouraged to pursue other designs along these conceptual lines, e.g., through virtual impedance control. For the task at hand, we have the \(R/X\) ratio \(\rho=1\), from which the generalized droop rotation angle should be determined as \(\phi=0.79\) rad. The lead-lag compensator can

Fig. 8: Comparing the response of the detailed and simplified inverter models.

be designed with \(\tau=1\) ms (say). The Bode characteristics of the compensator are compared with that of the original filter in Fig. 10. Students are also expected to compare the steady state outputs of their generalized droop controllers against the original ones from Task-5, for the same three-inverter microgrid system. Specifically, the generalized droop control does not enforce proportional active or reactive power sharing, as seen from the steady-state readings from Table V. Students are then instructed on the need for secondary control in order to mitigate the inequity in power sharing.
* Task-7: Here, students will adopt the same design approach outlined in Task-5 by finding the new maximum droop gains that make the three-inverter microgrid critically stable. The objective of this task is to provide compelling arguments that justify the superiority of their developed generalized droop controllers from Task-6. The anticipated outcome is that larger droop gains can be utilized without causing power sharing instability as shown in Fig. 11. This extended region is defined as the improved stability. In addition, the use of larger droop gains enable the system to reach the steady state at a faster rate after a disturbance. With the tasks heretofore, students should have developed a detailed understanding of inverter control and power sharing stability within a microgrid.
* Task-8: In this task, students will study the impact of improper design of the lead-lag compensator on the system stability. The system stability is theoretically guaranteed when the phase lead of the compensator exactly cancels the lag of the inductive line dynamics. Here, the students will attempt to violate this condition and verify that the stability is indeed compromised. Specifically, the expected results from Fig. 12 show the system becoming marginally stable when the value of the designed \(\rho\) significantly deviates from the actual \(R/X\) ratio on either side. Note that the actual damping of the system depends on the value of \(\tau\) selected. Overall, this task contributes to a better appreciation of the effect that the line dynamics have on stability.
* Task-9: In order to verify the accuracy of the waveforms obtained from the hardware setup, the students will first obtain simulation results considering the new ratings and system parameters taken from Table II. Note that these new power and voltage ratings-respectively 200 VA and 21 V (per phase)-should be taken as the per-unit bases for parameterizing the droop controllers and for scaling the measured waveforms. On successfully demonstrating their numerical results to the teaching assistants, they will be permitted to insert their designed values and conduct practical experiments. The first purpose of this approach is to examine students' ability to relate theory to practice and train their experimental skills. Second, due to the difference in system parameters between the simulation and experimental case studies, this task also allows students to verify that the droop controller design can be readily adapted for the experimental system by plugging in the appropriate \(R/X\) value. The anticipated design values of

Fig. 10: Bode plots for the conventional power measurement filter \(F_{0}(s)\) and the designed lead-lag compensator \(F(s)\).

Fig. 9: Active and reactive power waveforms for the three-inverter microgrid as the frequency droop gains of each inverter are increased one by one to identify the point of critical stability, which is: (a) Inverter-1 \(k_{f1}=0.81\%\), (b) Inverter-2 \(k_{f2}=0.56\%\), and (c) Inverter-3 \(k_{f3}=0.81\%\).

the improved droop controller are \(\rho=0.88\), \(\phi=0.72\) rad and \(\tau=1\) ms. The students are expected to identify the individual frequency droop gain at each node that makes the system unstable (5.11%, 2.27% and 5.11% respectively), and show that the same droop gains are stable when generalized droop control is used. The expected waveforms are shown in Fig. 13. The experimental results should be similar to the corresponding numerical waveforms. Minor differences between the two can arise depending on the calibration of the sensors, as well as tolerances in the line and load impedances.

### _Student Performance and Feedback_

The subject of AC microgrids with droop-controlled inverters was included as one of six topics in a graduate module at the National University of Singapore entitled EE5702--Advanced Power System Analysis in Fall 2020. The associated theory aspects were tested during the final examination and contributed to 12.5% of the final marks in the module. The assignment described in this paper was one of two design projects for the module, and contributed an additional 15% to the final marks. Of the 38 enrolled students, 22 were part-time students from the industry. The fundamentals of inverter modeling, control, and simulation were first taught in 6 hours of lectures. Subsequently, students had four weeks to complete the design project and submit a detailed report. Two teaching assistants and one postdoctoral researcher were assigned to the module.

The distributions of the total marks and the marks scored per task can be found in Section S1 of the Supplementary File. Overall, the students did moderately well, with a class average score of 60% and a median of 69%. The top mark was 98% and the lowest 2%. It should be noted that the students were not able to execute Task-9 owing to the COVID-19 pandemic. At that time, the National University of Singapore was under partial lockdown, and students were not allowed to work on campus. Nevertheless, experiments were carried out by the instructors and the results shared with the students.

A survey was administered at the completion of the module, the results of which are given in Section S2 of the Supplementary File. Of the 38 enrolled students, 21 responded. Students generally appreciated the holistic approach in teaching power system dynamics with practical case studies and solutions, with 67% of the respondents expressing positive feedback. Further, 81% of

Fig. 11: Performance of the designed generalized droop controllers when subjected to the same frequency droop gain variations as those from Fig. 9. The droop gains are: (a) Inverter-1 \(k_{f1}=0.81\)%, (b) Inverter-2 \(k_{f2}=0.56\)%, and (c) Inverter-3 \(k_{f3}=0.81\)%.

Fig. 12: Active and reactive power waveforms for the three-inverter microgrid for (a) \(\rho=1.0\), (b) \(\rho=0.1\), and (c) \(\rho=7.0\). The damping performance worsens as the mismatch between the designed and true \(\rho\) value increases.

the respondents reported that the module had enhanced their critical thinking and interest in power systems. Based on informal feedback received during the course such as email exchanges and from office hours, one common issue was the lack of available textbooks on the topic of droop-controlled inverters. Although there are published books in the literature, many are collections of technical papers. As such, they demand extensive prerequisite knowledge in power electronics and power systems, and lack illustrative examples with detailed working steps. Recognizing this issue, we then presented additional numerical examples to strengthen students' learnings along with tutorial sessions on developing simulation models. This experience clearly raises the need for a step-by-step textbook targeting beginners regarding system-level analysis of inverter-based power systems. Against this background, nearly 95% of the respondents rated the module to be either _difficult_ or _very difficult_. At the same time, the students also agreed that the project helped them better appreciate the practical applications of such topics that are traditionally purely research oriented.

At the end of the project, most were able to apply the abstract control theory into controller design, and validate the inverter performance through numerical simulations and hardware-based experimentation. Despite the omission of several practical design considerations such as inverters' interaction with synchronous generators and secondary control functionality, this project trains students with the core skill sets required to manage inverter-based renewable generation. Specifically, part-time students found the taught skills to be useful in their daily engineering jobs. From this viewpoint, this educational project is arguably a success.

## IV Conclusion

An educational project consisting of step-by-step procedures for inverter modeling, control design, and performance validation was presented in this paper. The objective is to train students/engineers on the mathematical concepts of stability and control using numerical tools and an experimental testbed. This project was tailored for postgraduate students with prior experience in power systems and power electronics. Specifically, the project tasks address control design both at the power electronic converter level and power systems level. While completing these tasks, students are exposed to the modeling of a single inverter as well as that of a microgrid consisting of multiple inverters. The development of droop controllers enables students to appreciate the importance of system stability when inverters are increasingly interconnected in future electric grids. An educational microgrid testbed has been developed, which enables students to validate their inverter controllers in a laboratory environment. Based on the student feedback from Fall 2020, many found the project both challenging and inspiring. The students understood the practical benefits of the skills they have mastered during the lectures, and have become more passionate about contributing to a more power-electronic future grid.

Fig. 13: Experimental and corresponding simulation results when the frequency droop gain of each inverter is individually changed from the nominal value to its stability limit. The nominal droop gains of the inverters are \(k_{f}=0.1\%\) and \(k_{v}=5.0\%\), and the stability limits for the individual frequency droop gains are as follows: \(k_{f1}\): 5.11%, \(k_{f2}\): 2.27%, \(k_{f3}\): 5.11%.

## References

* [1] D. Hammell, "Supplying power where power is due: Annobon island microgrid," Accessed on: 1 April 2021, [Online]. Available: [https://microgridknowledge.com/supplying-power-where-power-is-due-annobon-island-microgrid](https://microgridknowledge.com/supplying-power-where-power-is-due-annobon-island-microgrid)
* [2] N. Pogaku, M. Prodanovic, and T. C. Green, "Modeling, analysis and testing of autonomous operation of an inverter-based microgrid," _IEEE Trans. Power Electron._, vol. 22, no. 2, pp. 613-625, Mar. 2007.
* [3] G. P. Raman and J. C.-H. Peng, "Mitigating stability issues due to line dynamics in droop-controlled multi-inverter systems," _IEEE Trans. Power Syst._, vol. 35, no. 3, pp. 2082-2092, May. 2020.
* [4] P. Vorobev, P.-H. Huang, M. Al Hosani, J. L. Kirtley, and K. Turitsyn, "High-fidelity model order reduction for microgrids stability assessment," _IEEE Trans. Power Syst._, vol. 33, no. 1, pp. 874-887, Jan. 2018.
* [5] Y. Lin _et al._, "Research roadmap on grid-forming inverters," National Renewable Energy Lab. (NREL), Golden, CO, USA, Tech. Rep., NREL/TP-SDO-7476, 2020.
* [6] R. H. Lasseter, Z. Chen, and D. Pattabiraman, "Grid-forming inverters: A critical asset for the power grid," _IEEE Trans. Emerg. Sel. Topics Power Electron._, vol. 8, no. 2, pp. 925-935, Jun. 2020.
* [7] M. C. Chandorkar, D. M. Divan, and R. Adapa, "Control of parallel connected inverters in standalone ac supply systems," _IEEE Trans. Ind. Appl._, vol. 29, no. 1, pp. 136-143, Jan.-Fei. 1993.
* [8] P. C. Kotsampopoulos, V. A. Kletrakis, and N. D. Hatzizyriou, "Laboratory education of modern power systems using PHIL simulation," _IEEE Trans. Power Syst._, vol. 32, no. 5, pp. 3992-4001, Sep. 2017.
* [9] M. A. Cohen, G. O. Niemeyer, and D. S. Callaway, "Griddle:Video gaming for power system education," _IEEE Trans. Power Syst._, vol. 32, no. 4, pp. 3069-3077, Jul. 2017.
* [10] A. B. Birchfield, T. J. Overbye, and K. R. Davis, "Educational applications of large synthetic power grids," _IEEE Trans. Power Syst._, vol. 34, no. 1, pp. 765-772, Jan. 2019.
* [11] S. B. Leeb, M. Alvira, R. W. Cox, J. J. Cooley, J. L. Kirtley, and S. R. Shaw, "Build to win: Power electronics," _IEEE Trans. Power Syst._, vol. 29, no. 4, pp. 1936-1943, Jul. 2014.
* [12] N. Mohan, A. K. Jain, P. Jose, and R. Ayyanar, "Teaching utility applications of power electronics in a first convens on power systems," _IEEE Trans. Power Syst._, vol. 19, no. 1, pp. 40-47, Feb. 2004.
* [13] Y. Glemaree, "Financing off-grid sustainable energy access for the poor," _Energy Policy_, vol. 47, pp. 87-93, 2012.
* [14] M. Dorman, "Access to electricity in small island developing states of the pacific: Issues and challenges," _Renewable Sustain. Energy Rev._, vol. 31, pp. 726-735, 2014.
* [15] N. J. Williams, P. Jaramillo, J. Taneja, and T. S. Ustun, "Enabling private sector investment in microgrid-based rural electrification in developing countries: A review," _Renewable Sustain. Energy Rev._, vol. 52, pp. 1268-1281, 2015.
* [16] D. Akinycle, J. Belikov, and Y. Levron, "Challenges of Microgrids in Remote Communities: A STEEP Model Application," _Energies_, vol. 11, no. 2, p. 432, Feb. 2018.
* [17] N. Bottrell, M. Prodanovic, and T. C. Green, "Dynamic stability of a microgrid with an active load," _IEEE Trans. Power Electron._, vol. 28, no. 11, pp. 5107-5119, Nov. 2013.
* [18] J. C.-H. Peng, G. P. Raman, and J. L. Soon, "Inverter-based design project files," Accessed on: 1 April 2021, [Online]. Available: [https://www.englaboratory.com/educational-project](https://www.englaboratory.com/educational-project)
* [19] P. C. Loh, D. Li, Y. K. Chai, and F. Blaabierg, "Hybrid AC-DC microgrids with energy storages and progressive energy flow tuning," _IEEE Trans. Power Electron._, vol. 28, no. 4, pp. 1533-1543, Apr. 2013.
* [20] Y. A. R. I. Mohamed and E. F. El-Saadany, "Adaptive decentralized droop controller to preserve power sharing stability of paralleled inverters in distributed generation microgrids," _IEEE Trans. Power Electron._, vol. 23, no. 6, pp. 2806-2816, Nov. 2008.
* [21] Z. Qu, J. C.-H. Peng, H. Yang, and D. Srinivasan, "Modeling and analysis of inner controls effects on damping and synchronizing torque components in VSG-controlled converter," _IEEE Trans. Energy Convers._, vol. 36, no. 1, pp. 488-499, Mar. 2021.
* [22] G. P. Raman and J. C.-H. Peng, "Filter deballasting control of droop-controlled inverters," _IEEE Trans. Power Electron._, vol. 36, no. 11, pp. 13107-13117, Nov. 2021.
* [23] Digi-Key. Accessed on: 1 April 2021, [Online]. Available: [https://www.digiskey.com/en/products](https://www.digiskey.com/en/products)

\begin{tabular}{c c}  & Jimmy Chih-Hsien Peng (Senior Member, IEEE) received the B.E. and Ph.D. degrees in electrical and computer engineering from the University of Auckland, Auckland, New Zealand, in 2008 and 2012, respectively. He is currently an Assistant Professor of electrical and computer engineering with the National University of Singapore, Singapore, Previously, he was an Assistant Professor with Masdar Institute (now part of the Khalifa University), Abu Dhabi, United Arab Emirates. In 2013, he was appointed a Visiting Scientist with the Research Laboratory of Electronics, Massachusetts Institute for Technology, Cambridge, MA, USA, where he became a Visiting Assistant Professor in 2014. His research interests include power system stability, cyber security, microgrids, and high-performance computing. He is currently the Secretary of the IEEE Power and Energy Society Working Group on High-Performance Computing for Power Grid Analysis and Operation. He is also a Member of the Electrical and Electronics Standards Committee of the Singapore Standards Council. \\ \end{tabular} \begin{tabular}{c c}  & Guruprasneh Raman (Member, IEEE) received the B.Tech. degree in electrical and electronics engineering from the National Institute of Technology, Trinchigappalli, India, in 2016 and the Ph.D. degree in electrical and computer engineering from the National University of Singapore, Singapore, in 2021. He is currently a Research Fellow with the Singapore ETI Centre and National University of Singapore, working on the Future Resilient Systems programme. His research interests include modeling data corruption in active distribution systems and stability analysis of microgrids. \\ \end{tabular} \begin{tabular}{c c}  & John Long Soon (Member, IEEE) received the Master's and Ph.D. degrees in electrical engineering from the University of Sydney, Sydney, NSW, Australia, in 2015 and 2019, respectively. From 2018 to 2019, he was a Professional Laboratory Officer with the School of Electrical and Information Engineering, University of Sydney. Since 2019, he has been a Research Fellow with the Department of Electrical and Computer Engineering, National University of Singapore, Singapore, where his focus is on fault-tolerant converters, reliability of power electronics, and converter topologies. \\ \end{tabular} 
\begin{tabular}{c c}  & Nikos D. Hatziergyiou (Fellow, IEEE) is currently a Professor of power systems with the National Technical University of Athens, Athens, Greece. He has more than 10 years' industrial experience as the Chairman and CEO of Hellenic Distribution Network Operator (HENDO), and as an Executive Vice-Chair and the Deputy CEO of Public Power Corporation (PPC), responsible for Transmission and Distribution Divisions. He was the Chair and Vice-Chair of the EU Technology and Innovation Platform on Smart Networks for Energy Transition (ETIP-SNET). He is the author of the book _Microgrids: Architectures and Control_ and of more than 250 journal publications and 500 conference proceedings papers. He is an Honorary Member of CIGRE and the past Chair of CIGRE SC Co Distribution Systems and Distributed Generation. He is the past Chair of Power System Dynamic Performance Committee (PSDPC) and currently Editor-in-Chior of the IEEE Transactions on Power Systems. He was the 2017 recipient of the IEEE/PES Prabba S. Kundar Power System Dynamics and Control Award. He has participated in more than 60 R&DdP projects funded by the EU Commission, electric utilities and industry for fundamental research and practical applications. He is included in the 2016, 2017 and 2019 Thomson Reuters lists of the top 1% most cited researchers and he is a 2020 Globe Energy Prize laureate. \\ \end{tabular}